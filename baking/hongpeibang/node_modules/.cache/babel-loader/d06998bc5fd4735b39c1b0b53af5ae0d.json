{"ast":null,"code":"module.exports = function (THREE) {\n  /**\n   * @author miibond\n   *\n   * Full-screen tone-mapping shader based on http://www.graphics.cornell.edu/~jaf/publications/sig02_paper.pdf\n   */\n  THREE.ToneMapShader = {\n    uniforms: {\n      \"tDiffuse\": {\n        type: \"t\",\n        value: null\n      },\n      \"averageLuminance\": {\n        type: \"f\",\n        value: 1.0\n      },\n      \"luminanceMap\": {\n        type: \"t\",\n        value: null\n      },\n      \"maxLuminance\": {\n        type: \"f\",\n        value: 16.0\n      },\n      \"middleGrey\": {\n        type: \"f\",\n        value: 0.6\n      }\n    },\n    vertexShader: [\"varying vec2 vUv;\", \"void main() {\", \"vUv = uv;\", \"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\", \"}\"].join(\"\\n\"),\n    fragmentShader: [\"uniform sampler2D tDiffuse;\", \"varying vec2 vUv;\", \"uniform float middleGrey;\", \"uniform float maxLuminance;\", \"#ifdef ADAPTED_LUMINANCE\", \"uniform sampler2D luminanceMap;\", \"#else\", \"uniform float averageLuminance;\", \"#endif\", \"const vec3 LUM_CONVERT = vec3(0.299, 0.587, 0.114);\", \"vec3 ToneMap( vec3 vColor ) {\", \"#ifdef ADAPTED_LUMINANCE\", // Get the calculated average luminance \n    \"float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;\", \"#else\", \"float fLumAvg = averageLuminance;\", \"#endif\", // Calculate the luminance of the current pixel\n    \"float fLumPixel = dot(vColor, LUM_CONVERT);\", // Apply the modified operator (Eq. 4)\n    \"float fLumScaled = (fLumPixel * middleGrey) / fLumAvg;\", \"float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);\", \"return fLumCompressed * vColor;\", \"}\", \"void main() {\", \"vec4 texel = texture2D( tDiffuse, vUv );\", \"gl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );\", \"}\"].join(\"\\n\")\n  };\n};","map":{"version":3,"sources":["E:/baking/hongpeibang/node_modules/three-js/addons/ToneMapShader.js"],"names":["module","exports","THREE","ToneMapShader","uniforms","type","value","vertexShader","join","fragmentShader"],"mappings":"AAAAA,MAAM,CAACC,OAAP,GAAiB,UAAUC,KAAV,EAAiB;AACjC;;;;;AAMAA,EAAAA,KAAK,CAACC,aAAN,GAAsB;AAErBC,IAAAA,QAAQ,EAAE;AAET,kBAAY;AAAEC,QAAAA,IAAI,EAAE,GAAR;AAAaC,QAAAA,KAAK,EAAE;AAApB,OAFH;AAGT,0BAAqB;AAAED,QAAAA,IAAI,EAAE,GAAR;AAAaC,QAAAA,KAAK,EAAE;AAApB,OAHZ;AAIT,sBAAiB;AAAED,QAAAA,IAAI,EAAE,GAAR;AAAaC,QAAAA,KAAK,EAAE;AAApB,OAJR;AAKT,sBAAiB;AAAED,QAAAA,IAAI,EAAE,GAAR;AAAaC,QAAAA,KAAK,EAAE;AAApB,OALR;AAMT,oBAAe;AAAED,QAAAA,IAAI,EAAE,GAAR;AAAaC,QAAAA,KAAK,EAAE;AAApB;AANN,KAFW;AAWrBC,IAAAA,YAAY,EAAE,CAEb,mBAFa,EAIb,eAJa,EAMZ,WANY,EAOZ,2EAPY,EASb,GATa,EAWZC,IAXY,CAWN,IAXM,CAXO;AAwBrBC,IAAAA,cAAc,EAAE,CAEf,6BAFe,EAIf,mBAJe,EAMf,2BANe,EAOf,6BAPe,EAQf,0BARe,EASd,iCATc,EAUf,OAVe,EAWd,iCAXc,EAYf,QAZe,EAcf,qDAde,EAgBf,+BAhBe,EAiBd,0BAjBc,EAkBb;AACA,gEAnBa,EAoBd,OApBc,EAqBb,mCArBa,EAsBd,QAtBc,EAwBd;AACA,iDAzBc,EA2Bd;AACA,4DA5Bc,EA8Bd,kHA9Bc,EA+Bd,iCA/Bc,EAgCf,GAhCe,EAkCf,eAlCe,EAoCd,0CApCc,EAsCd,uDAtCc,EAwCf,GAxCe,EA0CdD,IA1Cc,CA0CR,IA1CQ;AAxBK,GAAtB;AAsEA,CA7ED","sourcesContent":["module.exports = function( THREE ){\n\t/**\n\t * @author miibond\n\t *\n\t * Full-screen tone-mapping shader based on http://www.graphics.cornell.edu/~jaf/publications/sig02_paper.pdf\n\t */\n\n\tTHREE.ToneMapShader = {\n\n\t\tuniforms: {\n\n\t\t\t\"tDiffuse\": { type: \"t\", value: null },\n\t\t\t\"averageLuminance\":  { type: \"f\", value: 1.0 },\n\t\t\t\"luminanceMap\":  { type: \"t\", value: null },\n\t\t\t\"maxLuminance\":  { type: \"f\", value: 16.0 },\n\t\t\t\"middleGrey\":  { type: \"f\", value: 0.6 }\n\t\t},\n\n\t\tvertexShader: [\n\n\t\t\t\"varying vec2 vUv;\",\n\n\t\t\t\"void main() {\",\n\n\t\t\t\t\"vUv = uv;\",\n\t\t\t\t\"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\n\n\t\t\t\"}\"\n\n\t\t].join( \"\\n\" ),\n\n\t\tfragmentShader: [\n\n\t\t\t\"uniform sampler2D tDiffuse;\",\n\n\t\t\t\"varying vec2 vUv;\",\n\n\t\t\t\"uniform float middleGrey;\",\n\t\t\t\"uniform float maxLuminance;\",\n\t\t\t\"#ifdef ADAPTED_LUMINANCE\",\n\t\t\t\t\"uniform sampler2D luminanceMap;\",\n\t\t\t\"#else\",\n\t\t\t\t\"uniform float averageLuminance;\",\n\t\t\t\"#endif\",\n\t\t\t\n\t\t\t\"const vec3 LUM_CONVERT = vec3(0.299, 0.587, 0.114);\",\n\n\t\t\t\"vec3 ToneMap( vec3 vColor ) {\",\n\t\t\t\t\"#ifdef ADAPTED_LUMINANCE\",\n\t\t\t\t\t// Get the calculated average luminance \n\t\t\t\t\t\"float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;\",\n\t\t\t\t\"#else\",\n\t\t\t\t\t\"float fLumAvg = averageLuminance;\",\n\t\t\t\t\"#endif\",\n\t\t\t\t\n\t\t\t\t// Calculate the luminance of the current pixel\n\t\t\t\t\"float fLumPixel = dot(vColor, LUM_CONVERT);\",\n\n\t\t\t\t// Apply the modified operator (Eq. 4)\n\t\t\t\t\"float fLumScaled = (fLumPixel * middleGrey) / fLumAvg;\",\n\n\t\t\t\t\"float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);\",\n\t\t\t\t\"return fLumCompressed * vColor;\",\n\t\t\t\"}\",\n\n\t\t\t\"void main() {\",\n\n\t\t\t\t\"vec4 texel = texture2D( tDiffuse, vUv );\",\n\t\t\t\t\n\t\t\t\t\"gl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );\",\n\n\t\t\t\"}\"\n\n\t\t].join( \"\\n\" )\n\n\t};\n\n}\n"]},"metadata":{},"sourceType":"script"}